<!DOCTYPE html>
<html lang="en" dir=>

<head>
  <meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<meta name="description" content="PKI PKI (Public Key Infrastructure) resource is responsible for generating all X.509 certificates and RSA key pairs which are required by Kubernetes cluster. Kubernetes requires several certificates to be generated, with specific CNs, different CAs etc, which is difficult to manage, so Flexkube provides configurable and convenient interface to manage them.
All certificates are generated by following Kubernetes PKI certificates and requirements best practices.
Current implementation of PKI is experimental and only supports generating the certificates.">
<meta name="theme-color" content="#FFFFFF"><meta property="og:title" content="" />
<meta property="og:description" content="PKI PKI (Public Key Infrastructure) resource is responsible for generating all X.509 certificates and RSA key pairs which are required by Kubernetes cluster. Kubernetes requires several certificates to be generated, with specific CNs, different CAs etc, which is difficult to manage, so Flexkube provides configurable and convenient interface to manage them.
All certificates are generated by following Kubernetes PKI certificates and requirements best practices.
Current implementation of PKI is experimental and only supports generating the certificates." />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://flexkube.github.io/documentation/resources/pki/" /><meta property="article:section" content="documentation" />



<title>Pki | Flexkube</title>
<link rel="manifest" href="/manifest.json">
<link rel="icon" href="/favicon.png" type="image/x-icon">
<link rel="stylesheet" href="/book.min.9efae0ff4215c1c9b9ff428703b1e98208fa842709fb18caf11dda700085c8e8.css" integrity="sha256-nvrg/0IVwcm5/0KHA7Hpggj6hCcJ&#43;xjK8R3acACFyOg=">
<script defer src="/en.search.min.e84c9db588351f9155c760ac4b19b273e24b0235df3344ade01a6c1c82fd4a7f.js" integrity="sha256-6EydtYg1H5FVx2CsSxmyc&#43;JLAjXfM0St4BpsHIL9Sn8="></script>
<!--
Made with Book Theme
https://github.com/alex-shpak/hugo-book
-->

  <link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png">
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png">
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png">
<link rel="manifest" href="/site.webmanifest">
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#0076a5">
<meta name="msapplication-TileColor" content="#00aba9">
<meta name="theme-color" content="#ffffff">

</head>

<body>
  <input type="checkbox" class="hidden" id="menu-control" />
  <main class="container flex">
    <aside class="book-menu">
      
  <nav>
<h2 class="book-brand">
  <a href="/"><img src="/assets/icon.svg" alt="Logo" /><span>Flexkube</span>
  </a>
</h2>


<div class="book-search">
  <input type="text" id="book-search-input" placeholder="Search" aria-label="Search" maxlength="64" data-hotkeys="s/" />
  <div class="book-search-spinner spinner hidden"></div>
  <ul id="book-search-results"></ul>
</div>











  <ul>
<li><a href="/documentation/"><strong>Documentation</strong></a>
<ul>
<li><a href="/documentation/getting-started/">Getting Started</a>
<ul>
<li><a href="/documentation/getting-started/requirements/">Requirements</a>
<ul>
<li><a href="/documentation/getting-started/requirements/creating-virtual-machines-for-testing/">Creating virtual machines for testing</a></li>
</ul>
</li>
<li><a href="/documentation/getting-started/installing/">Installing</a>
<ul>
<li><a href="/documentation/getting-started/installing/cli/">CLI binary</a></li>
<li><a href="/documentation/getting-started/installing/terraform/">Terraform Provider</a></li>
<li><a href="/documentation/getting-started/installing/go/">Go module</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/documentation/guides/">Guides</a>
<ul>
<li><a href="/documentation/guides/etcd/">etcd</a>
<ul>
<li><a href="/documentation/guides/etcd/creating-single-member-cluster-on-local-machine-using-terraform/">Creating single-member cluster on local machine using Terraform</a></li>
<li><a href="/documentation/guides/etcd/creating-single-member-cluster-on-local-machine-using-flexkube-cli/">Creating single-member cluster on local machine using Flexkube CLI</a></li>
<li><a href="/documentation/guides/etcd/creating-multi-member-cluster-over-ssh-using-terraform/">Creating multi-node cluster over SSH using Terraform</a></li>
</ul>
</li>
<li><a href="/documentation/guides/kubernetes/">Kubernetes</a>
<ul>
<li><a href="/documentation/guides/kubernetes/creating-single-node-cluster-on-local-machine-using-flexkube-cli/">Creating single-node cluster on local machine using &ldquo;flexkube&rdquo; CLI</a></li>
<li><a href="/documentation/guides/kubernetes/creating-single-node-cluster-on-local-machine-using-terraform/">Creating single-node cluster on local machine using Terraform</a></li>
<li><a href="/documentation/guides/kubernetes/creating-multi-node-cluster-using-terraform/">Creating multi-node cluster using Terraform</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/documentation/examples/">Examples</a>
<ul>
<li><a href="/documentation/examples/cli/">CLI</a></li>
<li><a href="/documentation/examples/terraform/">Terraform</a></li>
<li><a href="/documentation/examples/go/">Go</a></li>
</ul>
</li>
<li><a href="/documentation/concepts/">Concepts</a>
<ul>
<li><a href="/documentation/concepts/managing-containers/">Managing containers</a></li>
<li><a href="/documentation/concepts/managing-certificates/">Managing Kubernetes certificates</a></li>
<li><a href="/documentation/concepts/supported-transport-protocols/">Supported transport protocols</a>
<ul>
<li><a href="/documentation/concepts/supported-transport-protocols/direct/">Direct</a></li>
<li><a href="/documentation/concepts/supported-transport-protocols/ssh/">SSH</a></li>
</ul>
</li>
<li><a href="/documentation/concepts/supported-container-runtimes/">Supported container runtimes</a>
<ul>
<li><a href="/documentation/concepts/supported-container-runtimes/docker/">Docker</a></li>
</ul>
</li>
<li><a href="/documentation/concepts/self-hosted-kubernetes-controlplane/">Self-hosted Kubernetes controlplane</a></li>
</ul>
</li>
<li><a href="/documentation/resources/">Resources</a>
<ul>
<li><a href="/documentation/resources/pki/"class=active>PKI</a></li>
<li><a href="/documentation/resources/etcd/">etcd</a></li>
<li><a href="/documentation/resources/api-loadbalancer/">API Load Balancer</a></li>
<li><a href="/documentation/resources/controlplane/">Controlplane</a></li>
<li><a href="/documentation/resources/kubelet-pool/">Kubelet Pool</a></li>
<li><a href="/documentation/resources/containers/">Containers</a></li>
</ul>
</li>
<li><a href="/documentation/helm-charts/">Helm charts</a>
<ul>
<li><a href="/documentation/helm-charts/maintained/">Maintained</a>
<ul>
<li><a href="/documentation/helm-charts/maintained/calico/">calico</a></li>
<li><a href="/documentation/helm-charts/maintained/kube-apiserver/">kube-apiserver</a></li>
<li><a href="/documentation/helm-charts/maintained/kube-proxy/">kube-proxy</a></li>
<li><a href="/documentation/helm-charts/maintained/kubelet-rubber-stamp/">kubelet-rubber-stamp</a></li>
<li><a href="/documentation/helm-charts/maintained/kubernetes/">kubernetes</a></li>
<li><a href="/documentation/helm-charts/maintained/tls-bootstrapping/">tls-bootstrapping</a></li>
</ul>
</li>
<li><a href="/documentation/helm-charts/upstream/">Upstream</a>
<ul>
<li><a href="/documentation/helm-charts/upstream/stable-coredns/">stable/coredns</a></li>
<li><a href="/documentation/helm-charts/upstream/stable-metrics-server/">stable/metrics-server</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/documentation/reference/">Reference</a>
<ul>
<li><a href="/documentation/reference/cli/">CLI</a>
<ul>
<li><a href="/documentation/reference/cli/configuration/">Configuration</a>
<ul>
<li><a href="/documentation/reference/cli/configuration/kubelet-pool/">kubelet-pool</a></li>
<li><a href="/documentation/reference/cli/configuration/apiloadbalancer-pool/">apiloadbalancer-pool</a></li>
<li><a href="/documentation/reference/cli/configuration/etcd/">etcd</a></li>
<li><a href="/documentation/reference/cli/configuration/pki/">pki</a></li>
<li><a href="/documentation/reference/cli/configuration/controlplane/">controlplane</a></li>
<li><a href="/documentation/reference/cli/configuration/containers/">containers</a></li>
</ul>
</li>
<li><a href="/documentation/reference/cli/commands/">Commands</a>
<ul>
<li><a href="/documentation/reference/cli/commands/kubelet-pool/">kubelet-pool</a></li>
<li><a href="/documentation/reference/cli/commands/apiloadbalancer-pool/">apiloadbalancer-pool</a></li>
<li><a href="/documentation/reference/cli/commands/etcd/">etcd</a></li>
<li><a href="/documentation/reference/cli/commands/pki/">pki</a></li>
<li><a href="/documentation/reference/cli/commands/controlplane/">controlplane</a></li>
<li><a href="/documentation/reference/cli/commands/kubeconfig/">kubeconfig</a></li>
<li><a href="/documentation/reference/cli/commands/containers/">containers</a></li>
</ul>
</li>
</ul>
</li>
<li><a href="/documentation/reference/terraform/">Terraform</a></li>
<li><a href="/documentation/reference/helm-charts/">Helm charts</a>
<ul>
<li><a href="/documentation/reference/helm-charts/kube-apiserver/">kube-apiserver</a></li>
<li><a href="/documentation/reference/helm-charts/kubernetes/">kubernetes</a></li>
<li><a href="/documentation/reference/helm-charts/tls-bootstrapping/">tls-bootstrapping</a></li>
<li><a href="/documentation/reference/helm-charts/calico/">calico</a></li>
<li><a href="/documentation/reference/helm-charts/kubelet-rubber-stamp/">kubelet-rubber-stamp</a></li>
</ul>
</li>
<li><a href="/documentation/reference/go/">Go</a></li>
</ul>
</li>
<li><a href="/documentation/project-status/">Project status</a></li>
</ul>
</li>
</ul>










</nav>




  <script>(function(){var a=document.querySelector("aside.book-menu nav");addEventListener("beforeunload",function(b){localStorage.setItem("menu.scrollTop",a.scrollTop)}),a.scrollTop=localStorage.getItem("menu.scrollTop")})()</script>


 
    </aside>

    <div class="book-page">
      <header class="book-header">
        
  <div class="flex align-center justify-between">
  <label for="menu-control">
    <img src="/svg/menu.svg" class="book-icon" alt="Menu" />
  </label>

  <strong>Pki</strong>

  <label for="toc-control">
    <img src="/svg/toc.svg" class="book-icon" alt="Table of Contents" />
  </label>
</div>


  
    <input type="checkbox" class="hidden" id="toc-control" />
    <aside class="hidden clearfix">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#example-configuration">Example configuration:</a></li>
  </ul>
</nav>


    </aside>
  
 
      </header>

      
      
  <article class="markdown"><h1 id="pki">PKI</h1>
<p>PKI (Public Key Infrastructure) resource is responsible for generating all X.509 certificates and RSA key pairs which are required by Kubernetes cluster. Kubernetes requires several certificates to be generated, with specific CNs, different CAs etc, which is difficult to manage, so Flexkube provides configurable and convenient interface to manage them.</p>
<p>All certificates are generated by following Kubernetes <a href="https://kubernetes.io/docs/setup/best-practices/certificates/">PKI certificates and requirements</a> best practices.</p>
<blockquote class="book-hint warning">
  Current implementation of PKI is experimental and only supports generating the certificates. Renewing the certificates or changing certificate properties is currently not implemented.
</blockquote>

<h2 id="example-configuration">Example configuration:</h2>




<div class="book-tabs"><input type="radio" class="hidden" name="tabs-uniqueid" id="tabs-uniqueid-0" checked="checked" />
  <label for="tabs-uniqueid-0">CLI</label>
  <div class="book-tabs-content markdown-inner"><p>To generate the certificates using <code>flexkube</code> CLI, create the following <code>config.yaml</code> file:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-yaml" data-lang="yaml"><span style="color:#f92672">pki</span>:
  <span style="color:#f92672">certificate</span>:
    <span style="color:#f92672">organization</span>: <span style="color:#e6db74">&#34;example&#34;</span>
  <span style="color:#f92672">etcd</span>:
    <span style="color:#f92672">peers</span>:
      <span style="color:#f92672">controller01</span>: <span style="color:#e6db74">&#34;192.168.1.10&#34;</span>
    <span style="color:#f92672">clientCNs</span>:
    - <span style="color:#e6db74">&#34;root&#34;</span>
    - <span style="color:#e6db74">&#34;kube-apiserver&#34;</span>
    - <span style="color:#e6db74">&#34;prometheus&#34;</span>
  <span style="color:#f92672">kubernetes</span>:
    <span style="color:#f92672">kubeAPIServer</span>:
      <span style="color:#f92672">externalNames</span>: <span style="color:#e6db74">&#34;kube-apiserver.example.com&#34;</span>
      <span style="color:#f92672">serverIPs</span>:
      - <span style="color:#e6db74">&#34;192.168.1.10&#34;</span>
</code></pre></div><p>Then, run the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">flexkube pki
</code></pre></div><p>If the configuration is correct, PKI will be created in <code>state.yaml</code> file.</p>
</div><input type="radio" class="hidden" name="tabs-uniqueid" id="tabs-uniqueid-1"  />
  <label for="tabs-uniqueid-1">Go</label>
  <div class="book-tabs-content markdown-inner"><p>To generate Kubernetes PKI using Go, for example create file <code>main.go</code> with following content:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-go" data-lang="go"><span style="color:#f92672">package</span> <span style="color:#a6e22e">main</span>

<span style="color:#f92672">import</span> (
  <span style="color:#e6db74">&#34;fmt&#34;</span>

  <span style="color:#e6db74">&#34;github.com/flexkube/libflexkube/pkg/pki&#34;</span>
)

<span style="color:#66d9ef">func</span> <span style="color:#a6e22e">main</span>() {
  <span style="color:#a6e22e">p</span> <span style="color:#f92672">:=</span> <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">PKI</span>{
    <span style="color:#a6e22e">Certificate</span>: <span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">Certificate</span>{
      <span style="color:#a6e22e">Organization</span>: <span style="color:#e6db74">&#34;example&#34;</span>,
    },
    <span style="color:#a6e22e">Etcd</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">Etcd</span>{
      <span style="color:#a6e22e">Peers</span>: <span style="color:#66d9ef">map</span>[<span style="color:#66d9ef">string</span>]<span style="color:#66d9ef">string</span>{
        <span style="color:#e6db74">&#34;controller01&#34;</span>: <span style="color:#e6db74">&#34;192.168.1.10&#34;</span>,
      },
      <span style="color:#a6e22e">ClientCNs</span>: []<span style="color:#66d9ef">string</span>{
        <span style="color:#e6db74">&#34;root&#34;</span>,
        <span style="color:#e6db74">&#34;kube-apiserver&#34;</span>,
        <span style="color:#e6db74">&#34;prometheus&#34;</span>,
      },
    },
    <span style="color:#a6e22e">Kubernetes</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">Kubernetes</span>{
      <span style="color:#a6e22e">KubeAPIServer</span>: <span style="color:#f92672">&amp;</span><span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">KubeAPIServer</span>{
        <span style="color:#a6e22e">ExternalNames</span>: []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;kube-apiserver.example.com&#34;</span>},
        <span style="color:#a6e22e">ServerIPs</span>:     []<span style="color:#66d9ef">string</span>{<span style="color:#e6db74">&#34;192.168.1.10&#34;</span>},
      },
    },
  }
  <span style="color:#a6e22e">p</span>.<span style="color:#a6e22e">Generate</span>()
  <span style="color:#a6e22e">fmt</span>.<span style="color:#a6e22e">Printf</span>(<span style="color:#e6db74">&#34;%+v&#34;</span>, <span style="color:#a6e22e">p</span>)
}
</code></pre></div><p>Then run the following command:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-sh" data-lang="sh">go run main.go
</code></pre></div><p>If everything went successfully, you should get all generated certificates with their properties printed. Please not, that it is up to the user to persist generated certificates when using Go interface.</p>
</div><input type="radio" class="hidden" name="tabs-uniqueid" id="tabs-uniqueid-2"  />
  <label for="tabs-uniqueid-2">Terraform</label>
  <div class="book-tabs-content markdown-inner"><p>To create Kubernetes PKI using Terraform, create <code>main.tf</code> file with the following content:</p>
<div class="highlight"><pre style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4"><code class="language-tf" data-lang="tf"><span style="color:#66d9ef">resource</span> <span style="color:#e6db74">&#34;flexkube_pki&#34;</span> <span style="color:#e6db74">&#34;pki&#34;</span> {
  <span style="color:#a6e22e">certificate</span> {
    <span style="color:#a6e22e">organization</span> = <span style="color:#e6db74">&#34;example&#34;</span>
  }

  <span style="color:#a6e22e">etcd</span> {
    <span style="color:#a6e22e">peers</span> = {
      <span style="color:#e6db74">&#34;controller01&#34;</span> <span style="color:#f92672">=</span> <span style="color:#e6db74">&#34;192.168.1.10&#34;</span>
    }

    <span style="color:#a6e22e">client_cns</span> = [
      <span style="color:#e6db74">&#34;root&#34;</span>,
      <span style="color:#e6db74">&#34;kube-apiserver&#34;</span>,
      <span style="color:#e6db74">&#34;prometheus&#34;</span>,
    ]
  }

  <span style="color:#a6e22e">kubernetes</span> {
    <span style="color:#a6e22e">kube_api_server</span> {
      <span style="color:#a6e22e">external_names</span> = [<span style="color:#e6db74">&#34;kube-apiserver.example.com&#34;</span>]
      <span style="color:#a6e22e">server_ips</span>     = [<span style="color:#e6db74">&#34;192.168.1.10&#34;</span>]
    }
  }
}
<span style="color:#66d9ef">
</span><span style="color:#66d9ef">output</span> <span style="color:#e6db74">&#34;kubernetes_ca&#34;</span> {
  <span style="color:#a6e22e">value</span> = <span style="color:#a6e22e">flexkube_pki</span>.<span style="color:#a6e22e">pki</span>.<span style="color:#a6e22e">kubernetes</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">ca</span>[<span style="color:#ae81ff">0</span>].<span style="color:#a6e22e">x509_certificate</span>
}
</code></pre></div><p>Then, run following commands:</p>
<pre><code>terraform init &amp;&amp; terraform apply
</code></pre><p>If everything went successfully, you should see Kubernetes CA certificate in PEM format printed as Terraform output.</p>
<p>To see all available parameters, see <a href="https://registry.terraform.io/providers/flexkube/flexkube/latest/docs/resources/pki">flexkube_pki</a> page in Terraform Registry documentation.</p>
</div></div>

</article>
 
      

      <footer class="book-footer">
        
  <div class="flex flex-wrap justify-between">





  <div>
    <a class="flex align-center" href="https://github.com/flexkube/website/edit/master/content//documentation/resources/pki.md" target="_blank" rel="noopener">
      <img src="/svg/edit.svg" class="book-icon" alt="Edit" />
      <span>Edit this page</span>
    </a>
  </div>

</div>

 
        
      </footer>

      
  
  <div class="book-comments">

</div>
  
 

      <label for="menu-control" class="hidden book-menu-overlay"></label>
    </div>

    
    <aside class="book-toc">
      
  <nav id="TableOfContents">
  <ul>
    <li><a href="#example-configuration">Example configuration:</a></li>
  </ul>
</nav>

 
    </aside>
    
  </main>

  
</body>

</html>












